<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="tierdrop">
<title>TIER MER Processing R Script SOP • tierdrop</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="TIER MER Processing R Script SOP">
<meta property="og:description" content="tierdrop">
<meta property="og:image" content="https://usaid-sa-si.github.io/tierdrop/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">tierdrop</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/TIER-MER-Processing-R-Script-SOP.html">TIER MER Processing SOP</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/USAID-SA-SI/tierdrop/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="TIER-MER-Processing-R-Script-SOP_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>TIER MER Processing R Script SOP</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/USAID-SA-SI/tierdrop/blob/HEAD/vignettes/TIER-MER-Processing-R-Script-SOP.Rmd" class="external-link"><code>vignettes/TIER-MER-Processing-R-Script-SOP.Rmd</code></a></small>
      <div class="d-none name"><code>TIER-MER-Processing-R-Script-SOP.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="purpose">Purpose:<a class="anchor" aria-label="anchor" href="#purpose"></a>
</h2>
<p>This script was developed to run the <code>tierdrop</code> package to process the TIER Data from NDOH for submission to DATIM. This article will serve as a SOP for how to utilize the <code>tierdrop</code> package for USAID South Africa’s MER Processing.</p>
<hr>
<div class="section level3">
<h3 id="part-a-step-up">Part A: Step up<a class="anchor" aria-label="anchor" href="#part-a-step-up"></a>
</h3>
<div class="section level4">
<h4 id="step-1-installing-r-package-tierdrop">Step 1: Installing R Package <code>tierdrop</code><a class="anchor" aria-label="anchor" href="#step-1-installing-r-package-tierdrop"></a>
</h4>
<p>Once you install packages on your machine, you will not need to re-install them unless there is a necessary update to the package. In this case, let’s install the <code>tierdrop</code> TIER processing package from Github. This package uses many functions from other R packages in the <code>tidyverse</code> and OHA packages.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#devtools::install_github("USAID-SA-SI/tierdrop", build_vignettes = TRUE)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"tidyverse"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="step-2-running-libraries-every-time-step">Step 2: Running Libraries (EVERY TIME STEP)<a class="anchor" aria-label="anchor" href="#step-2-running-libraries-every-time-step"></a>
</h4>
<p>Even though you have the packages install, your R session will not recognize the packages until you load them into the session. We use the <code><a href="https://rdrr.io/r/base/library.html" class="external-link">library()</a></code> function to load necessary packages.</p>
<p>Let’s load the <code>tierdrop</code> package developed for NDOH TIER processing, as well as the tidyverse. If you have not installed the <code>tidyverse</code> package yet, call <code>install.packages("tidyverse")</code> first.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">tierdrop</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/USAID-OHA-SI/glamr" class="external-link">glamr</a></span><span class="op">)</span></span>
<span><span class="co">#library(tidyverse)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="step-3-authenticate-google-drive-one-time-step">Step 3: Authenticate Google Drive (ONE-TIME STEP)<a class="anchor" aria-label="anchor" href="#step-3-authenticate-google-drive-one-time-step"></a>
</h4>
<p>Since many of our files live on Google drive, like the Master Facility list and the mapping files, we will need to authenticate our Google drive accounts with R so we can pull directly from these files. We will also need to do the same for setting out DATIM credentials to pull directly from DATIM.</p>
<p>We can use the <code><a href="https://rdrr.io/pkg/glamr/man/set_email.html" class="external-link">glamr::set_email()</a></code> function to store our email credentials in R and the <code><a href="https://rdrr.io/pkg/glamr/man/set_datim.html" class="external-link">glamr::set_datim()</a></code> function to store DATIM credentials. After doing so, we can load these credentials into the workspace by calling <code><a href="https://rdrr.io/pkg/glamr/man/load_secrets.html" class="external-link">glamr::load_secrets()</a></code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#glamr::set_email("ksrikanth@usaid.gov") #CHANGE TO YOUR EMAIL ADDRESS</span></span>
<span><span class="co">#glamr::set_datim("ksrikanth") #CHANGE TO YOUR USERNAME</span></span>
<span><span class="fu">glamr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/glamr/man/load_secrets.html" class="external-link">load_secrets</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="step-4-set-up-your-folder-directories-and-store-some-locals">Step 4: Set up your folder directories and store some locals<a class="anchor" aria-label="anchor" href="#step-4-set-up-your-folder-directories-and-store-some-locals"></a>
</h4>
<p>The biggest benefit of an R package is that now, anyone in USAID SA SI or the DMR team can use it to process the TIER data. To maximize collaboration and reproducibility, we want to ensure that we all have the folders appropriately set up on our devices.</p>
<ul>
<li>When we set up our directories, it will create folders for you to save files in and prompt you to save your files in specific locations:
<ul>
<li>Save the <strong>latest NDOH file</strong> in the <code>data-raw/NDOH</code> folder</li>
<li>Save the <strong>most recent site-level MSD or Genie pull from DATIM</strong> in the <code>data-raw/MSD-Genie</code>. If you do not have this, please pull it down from Panorama or DATIM genie before hand.</li>
</ul>
</li>
</ul>
<p>When you are done saving your files in the correct folders, enter <code>1</code> in the console to continue the action.</p>
<p>We also want to save some local objects to call on later for the current quarter and period. Please amend these manually for now, as we are still in development of automating this step.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#Set up folder directories</span></span>
<span><span class="fu"><a href="../reference/dir_setup.html">dir_setup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#set folderpaths</span></span>
<span><span class="va">ndoh_folderpath</span> <span class="op">&lt;-</span> <span class="st">'data-raw/NDOH'</span></span>
<span><span class="va">reference_folder</span> <span class="op">&lt;-</span> <span class="st">"data-raw/Reference Files"</span></span>
<span><span class="va">msd_folder</span> <span class="op">&lt;-</span> <span class="st">"data-raw/MSD-Genie"</span></span>
<span><span class="va">import_folder</span> <span class="op">&lt;-</span> <span class="st">"data-raw/Import Files"</span></span>
<span><span class="va">validation_folder</span> <span class="op">&lt;-</span> <span class="st">"data-raw/Validation Files"</span></span>
<span><span class="va">ndoh_filepath</span> <span class="op">&lt;-</span> <span class="va">ndoh_folderpath</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">glamr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/glamr/man/return_latest.html" class="external-link">return_latest</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">msd_filepath</span> <span class="op">&lt;-</span> <span class="va">msd_folder</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">glamr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/glamr/man/return_latest.html" class="external-link">return_latest</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#store some locals - change depending on the quarter</span></span>
<span><span class="va">fiscal_quarter</span> <span class="op">&lt;-</span> <span class="st">"FY22Q3"</span></span>
<span><span class="va">curr_qtr</span> <span class="op">&lt;-</span> <span class="st">"Q3"</span></span></code></pre></div>
<p>Finally, we want to check to make sure we are using the correct files by printing the file path. If it is not correct, please revisit your folder setup and ensure the correct files and saved in the correct places.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#do a quick check to make sure you have the file paths for NDOH and the MSD that you want: If not, </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ndoh_filepath</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">msd_filepath</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level3">
<h3 id="part-b-import-helper-data-files-mfl-genie-pull">Part B: Import helper data files (MFL, Genie Pull)<a class="anchor" aria-label="anchor" href="#part-b-import-helper-data-files-mfl-genie-pull"></a>
</h3>
<div class="section level4">
<h4 id="step-5-read-in-master-facility-list-mfl">Step 5: Read in Master Facility List (MFL)<a class="anchor" aria-label="anchor" href="#step-5-read-in-master-facility-list-mfl"></a>
</h4>
<p>We are going to read the Master Facility List (MFL) directly from Google Drive using the <code>googlesheets4::read_sheets()</code> function in the <code>googlesheets4</code> package. We are also going to import a tidy version of the MFL using <code><a href="../reference/clean_mfl.html">clean_mfl()</a></code>, a function in the <code>tierdrop</code> package, to have a tidy version of the MFL that we can use to join site-level data to the NDOH file.</p>
<p>The MFL will later be used in TIER processing to bring in the DSD/TA designation for each site in this reporting quarter. Here, we also using the <code><a href="https://rdrr.io/r/utils/head.html" class="external-link">head()</a></code> function to view the first 10 rows of the clean MFL list. This is a great way to inspect your data in R.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#Load MFL as is</span></span>
<span><span class="va">mfl_new_df</span> <span class="op">&lt;-</span> <span class="fu">googlesheets4</span><span class="fu">::</span><span class="fu"><a href="https://googlesheets4.tidyverse.org/reference/range_read.html" class="external-link">read_sheet</a></span><span class="op">(</span><span class="va">mfl_new_id</span>, sheet <span class="op">=</span> <span class="st">"MFL"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#then grab the clean MFL</span></span>
<span><span class="va">df_fac</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clean_mfl.html">clean_mfl</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df_fac</span>, <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="step-6-read-in-the-latest-msd-or-genie-pull">Step 6: Read in the latest MSD or Genie pull<a class="anchor" aria-label="anchor" href="#step-6-read-in-the-latest-msd-or-genie-pull"></a>
</h4>
<p>During the set-up, you pulled the latest MSD from Panorama or Genie and saved it to the <code>data-raw/MSD-Genie</code> folder. Now, we are going to read this in, as the NDOH processing script calls on the previous quarters MSD for some of the tidying, as well as the verification checks.</p>
<p>We are going to read in the MSD using some helper packages developed by OHA called <code>glamr</code> and <code>gophr</code>, which may it easier to work with the MER Structured Datasets in R.</p>
<p><em>Note</em> - Since we are loading in a site-level MSD, this section may take a few minutes to load.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#read the most recent MSD from the Genie folder</span></span>
<span><span class="va">df_genie</span> <span class="op">&lt;-</span> <span class="va">msd_folder</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">glamr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/glamr/man/return_latest.html" class="external-link">return_latest</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">gophr</span><span class="fu">::</span><span class="fu"><a href="https://usaid-oha-si.github.io/gophr/reference/read_msd.html" class="external-link">read_msd</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="step-7-pull-down-mechanism-meta-data-from-datim">Step 7: Pull down mechanism meta-data from DATIM<a class="anchor" aria-label="anchor" href="#step-7-pull-down-mechanism-meta-data-from-datim"></a>
</h4>
<p>Lastly, we need to pull down mechanism data in order to map the <code>mech_code</code> and <code>mechanism_uid</code> to each facility from NDOH. To do this, we connect to DATIM API and pull down mechanism level data for South Africa using <code><a href="../reference/pull_mech_uid.html">tierdrop::pull_mech_uid()</a></code>. This allows us to bring in the <code>mechanism_uid</code> information.</p>
<p><em>Note</em> - This section may take a few minutes to load as well, by virtue of having to connect to DATIM.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Note - this may take a few minutes to pull in</span></span>
<span><span class="va">mechs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pull_mech_uid.html">pull_mech_uid</a></span><span class="op">(</span>ou_sel <span class="op">=</span> <span class="st">"South Africa"</span><span class="op">)</span></span></code></pre></div>
<p>Now, we are going to use the mechanism data from DATIM and join it with facility-level mech-data from the MSD, to get a list of all the facilities reported to DATIM this fiscal year and map in the corresponding mechanism data.</p>
<p>To do so, we are going to use the <code><a href="../reference/grab_mech_data.html">grab_mech_data()</a></code> function from the <code>tierdrop</code> package.</p>
<ul>
<li>This function has 3 arguments:
<ul>
<li>
<code>mech_df</code> - the mechanism dataframe you got from <code><a href="../reference/pull_mech_uid.html">pull_mech_uid()</a></code> i.e. <code>mechs</code>
</li>
<li>
<code>msd_df</code> - latest MSD dataframe loaded i.e. <code>df_genie</code>
</li>
<li>
<code>extra_mechs</code> - Sometimes, you’ll have some extra mechs to encode manually - for example, in FY22Q3, there were two MATCH facilities that were not in DATIM yet, so we had to add these manually. If so, select <code>grab_mech_data(df, extra_mechs = TRUE)</code> and follow the prompt to ensure the data is saved correctly.</li>
</ul>
</li>
</ul>
<p>When you call <code><a href="../reference/grab_mech_data.html">grab_mech_data()</a></code>, you will be prompted to ensure that your additional files are saved in the correct place. If you have additional mechanism data that you are adding manually, please ensure that it is saved in the <code>data-raw/Reference Files</code> folder. If you have a file saved in that folder already, the filenpath will appear in blue.</p>
<p>-It is critical to ensure that the additional mechanism file (if used) has 4 columns named exactly as so: - <code>sitename</code> - <code>facilityuid</code> - <code>mech_code</code> - <code>prime_partner_name</code></p>
<p>When you are done saving your files in the correct folders, enter <code>1</code> in the console to continue the action.</p>
<p><em>Note - errors will likely be due to file path or naming issues</em></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mech_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/grab_mech_data.html">grab_mech_data</a></span><span class="op">(</span>mech_df <span class="op">=</span> <span class="va">mechs</span>, msd_df <span class="op">=</span> <span class="va">df_genie</span>, extra_mechs <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level3">
<h3 id="part-c-ndoh-file-processing">Part C: NDOH File Processing<a class="anchor" aria-label="anchor" href="#part-c-ndoh-file-processing"></a>
</h3>
<div class="section level4">
<h4 id="step-8-process-ndoh-file-and-convert-into-import-file-for-datim">Step 8: Process NDOH File and convert into import file for DATIM<a class="anchor" aria-label="anchor" href="#step-8-process-ndoh-file-and-convert-into-import-file-for-datim"></a>
</h4>
<p>Now that we have all of our dependencies and helper files set up, we can start to process the NDOH data!</p>
<p>In the <code>tierdrop</code> package, there is a function called <code>ndoh_processing</code> that runs through all the code to process, tidy, and prepare the NDOH file into a DATIM import file. We’ve set this up to be a one-line function that you can run, but this training will also give you a peek behind the curtain of the other helper functions.</p>
<ul>
<li>
<code>ndoh_processing</code> exports a data frame based on 3 main parameters:
<ul>
<li>
<code>filepath</code> = the most recent NDOH filepath</li>
<li>
<code>qtr</code> = current quarter (in format <code>Q_</code> ex: “Q3”)</li>
<li>
<code>export_type</code> = type of format you want the export in: (1) Import file format (2) Validation check format</li>
<li>
<code>save</code> = if TRUE, the data frame will be saved to the corresponding folder (default is TRUE)</li>
</ul>
</li>
</ul>
<p>Before we peek under the hood, let’s run the whole processing function as is. This is all you will need to process the NDOH file into a full import file. When you run <code><a href="../reference/ndoh_processing.html">ndoh_processing()</a></code>, the function will automatically save the import file or the validation file into the <code>data-raw/Import Files</code> or <code>data-raw/Validation Files</code> folders respectively.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_import</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ndoh_processing.html">ndoh_processing</a></span><span class="op">(</span>filepath <span class="op">=</span> <span class="va">ndoh_filepath</span>, qtr <span class="op">=</span> <span class="st">"Q3"</span>, export_type <span class="op">=</span> <span class="st">"Import"</span>, save<span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_validation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ndoh_processing.html">ndoh_processing</a></span><span class="op">(</span>filepath <span class="op">=</span> <span class="va">ndoh_filepath</span>, qtr <span class="op">=</span> <span class="st">"Q3"</span>, export_type <span class="op">=</span> <span class="st">"Validation"</span>, save<span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>You may also want to break the import file up by partner for each partner DQRT. For this, you can use the function <code><a href="../reference/partner_import.html">partner_import()</a></code> from the <code>tierdrop</code> package. When this function is run, the partner import files get automatically saved into the <code>data-raw/Import Files</code> folder.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Broadreach_import</span> <span class="op">&lt;-</span> <span class="fu">tierdrop</span><span class="fu">::</span><span class="fu"><a href="../reference/partner_import.html">partner_import</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">df_import</span>, <span class="fl">70287</span>, save <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">RTC_import</span> <span class="op">&lt;-</span> <span class="fu">tierdrop</span><span class="fu">::</span><span class="fu"><a href="../reference/partner_import.html">partner_import</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">df_import</span>, <span class="fl">70290</span>, save <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">ANOVA_import</span> <span class="op">&lt;-</span> <span class="fu">tierdrop</span><span class="fu">::</span><span class="fu"><a href="../reference/partner_import.html">partner_import</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">df_import</span>, <span class="fl">70310</span>, save <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">MATCH_import</span> <span class="op">&lt;-</span> <span class="fu">tierdrop</span><span class="fu">::</span><span class="fu"><a href="../reference/partner_import.html">partner_import</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">df_import</span>, <span class="fl">81902</span>, save <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">WRHI_import</span> <span class="op">&lt;-</span> <span class="fu">tierdrop</span><span class="fu">::</span><span class="fu"><a href="../reference/partner_import.html">partner_import</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">df_import</span>, <span class="fl">70301</span>, save <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Et voila! You have a TIER import file in the format for DATIM. This file can then be used to engage in the following steps of MER processing:</p>
<ol style="list-style-type: decimal">
<li><p>Send TIER Import files to partners</p></li>
<li><p>Run TIER DQRT for each partner level file</p></li>
<li><p>Consolidate with non-TIER partner files</p></li>
<li><p>Submit whole import file to DATIM</p></li>
</ol>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Karishma Srikanth.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
